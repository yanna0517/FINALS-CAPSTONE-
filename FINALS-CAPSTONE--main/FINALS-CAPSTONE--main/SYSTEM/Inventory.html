<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inventory</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Alfa+Slab+One&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-alfa { font-family: 'Alfa Slab One', cursive; text-shadow: 1px 1px 1px rgba(0,0,0,0.06); }
    .sidebar-link.active { background-color: #e5e7eb; color: #1f2937; }
    .sidebar-link.active svg { color: #3b82f6; }
    .modal-open { overflow: hidden; }
    /* Toasts (top-right, minimal white with colored left border) */
    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 60;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      align-items: flex-end;
      pointer-events: none;
    }
    .toast {
      pointer-events: auto;
      min-width: 260px;
      background: white;
      border-radius: 0.5rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      overflow: hidden;
      display: flex;
      align-items: center;
      transform-origin: top right;
      animation: toast-in .12s ease;
    }
    .toast .left-border { width: 6px; height: 100%; }
    .toast .content { padding: 0.75rem 0.85rem; flex: 1; }
    .toast .actions { padding: 0 0.75rem 0.75rem 0; display:flex; align-items:center; gap:.5rem; }
    .toast .undo { color: #2563eb; text-decoration: underline; cursor: pointer; font-weight:600; }
    @keyframes toast-in { from { opacity: 0; transform: translateY(-6px) scale(0.98); } to { opacity:1; transform: translateY(0) scale(1); } }
    @keyframes toast-out { from { opacity:1; transform: translateY(0) scale(1); } to { opacity:0; transform: translateY(-6px) scale(.98); } }

    /* low stock highlight */
    .low-stock {
      background-color: #fee2e2; /* light red when quantity < threshold */
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="h-screen flex overflow-hidden">
    <!-- Sidebar (UNCHANGED) -->
    <aside class="w-64 bg-white flex flex-col border-r flex-shrink-0">
      <div class="h-20 flex items-center justify-center border-b">
        <h1 class="font-alfa text-4xl tracking-wider">AUG DEPT.</h1>
      </div>

      <nav class="flex-1 px-4 py-6 space-y-2">
        <a href="Dashboard.html" class="sidebar-link flex items-center text-gray-600 hover:bg-gray-200 py-2.5 px-4 rounded-lg transition duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>
          Dashboard
        </a>

        <a href="Sales.html" class="sidebar-link flex items-center text-gray-600 hover:bg-gray-200 py-2.5 px-4 rounded-lg transition duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>
          Sales
        </a>

        <a href="#" class="sidebar-link active flex items-center text-gray-600 hover:bg-gray-200 py-2.5 px-4 rounded-lg transition duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>
          Inventory
        </a>

        <!-- other sidebar links -->
      </nav>

      <div class="px-4 py-6 border-t border-gray-200">
        <a href="#" class="sidebar-link flex items-center text-gray-600 hover:bg-gray-200 py-2.5 px-4 rounded-lg transition duration-200">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
          Logout
        </a>
      </div>
    </aside>

    <!-- Main content -->
    <main class="flex-1 p-8 overflow-y-auto bg-white">
      <h2 class="text-3xl font-bold mb-8">Inventory</h2>

      <!-- Search + Filter -->
      <div class="flex flex-wrap gap-4 items-center mb-6">
        <input id="searchInput" type="text" placeholder="Search product or category" 
          class="w-full md:w-1/3 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">

        <select id="categoryFilter" class="w-full md:w-1/4 px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
          <option value="all">All Categories</option>
          <option value="clothing">Clothing</option>
          <option value="accessories">Accessories</option>
          <option value="outdoor">Outdoor</option>
          <option value="fragrance">Fragrance</option>
        </select>

        <div class="ml-auto">
          <button id="openAddBtn" class="px-4 py-2 bg-white text-gray-700 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 font-medium">
            Add Product
          </button>
        </div>
      </div>

      <!-- Main Table -->
      <div class="border border-gray-200 rounded-lg overflow-hidden">
        <div class="flex text-sm font-semibold text-gray-600 bg-gray-50 px-6 py-3 border-b border-gray-200">
          <div class="w-1/4">Product</div>
          <div class="w-1/5">Category</div>
          <div class="w-1/5">Quantity</div>
          <div class="w-1/5">Total</div>
          <div class="w-1/6 text-right">Actions</div>
        </div>

        <div id="inventoryTable" class="divide-y divide-gray-200 min-h-[120px]">
          <div id="emptyHint" class="px-6 py-8 text-center text-gray-500">
            No products yet ‚Äî click <strong>Add Product</strong> to create your first item.
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add / Edit Modal -->
  <div id="productModal" class="fixed inset-0 z-40 hidden items-center justify-center px-4">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative bg-white rounded-2xl shadow-xl w-full max-w-lg mx-auto z-50 p-6">
      <h3 id="modalTitle" class="text-xl font-semibold mb-4">Add Product</h3>

      <form id="productForm" class="space-y-4" onsubmit="return false;">
        <div>
          <label class="block text-sm font-medium text-gray-700">Product</label>
          <select id="prodName" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
            <option value="">Select product</option>
            <option value="shirts">Shirts</option>
            <option value="cap">Cap</option>
            <option value="umbrella">Umbrella</option>
            <option value="perfume">Perfume</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700">Category</label>
          <!-- editable combo: text input with datalist so user can type or pick -->
          <input id="prodCategory" list="categoryList" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" />
          <datalist id="categoryList">
            <option value="clothing">Clothing</option>
            <option value="accessories">Accessories</option>
            <option value="outdoor">Outdoor</option>
            <option value="fragrance">Fragrance</option>
          </datalist>
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Quantity</label>
            <input id="prodQty" type="number" min="0" value="1" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Total (‚Ç±)</label>
            <input id="prodTotal" type="number" min="0" step="0.01" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500" />
            <div class="text-xs text-gray-400 mt-1">Auto-calculated from product price √ó quantity, but editable.</div>
          </div>
        </div>

        <div class="flex justify-end gap-3 pt-2">
          <button type="button" id="cancelModalBtn" class="px-4 py-2 rounded-md bg-white border border-gray-300 hover:bg-gray-50">Cancel</button>
          <button type="submit" id="saveProductBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">Add</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="fixed inset-0 z-50 hidden items-center justify-center px-4">
    <div class="absolute inset-0 bg-black/40"></div>
    <div class="relative bg-white rounded-2xl shadow-xl w-full max-w-md mx-auto z-50 p-6">
      <h3 class="text-lg font-semibold mb-2">Confirm Delete</h3>
      <p id="deleteMessage" class="text-sm text-gray-600">Are you sure you want to delete this product?</p>

      <div class="flex justify-end gap-3 pt-6">
        <button id="cancelDeleteBtn" class="px-4 py-2 rounded-md bg-white border border-gray-300 hover:bg-gray-50">No</button>
        <button id="confirmDeleteBtn" class="px-4 py-2 rounded-md bg-red-600 text-white hover:bg-red-700">Yes, delete</button>
      </div>
    </div>
  </div>

  <!-- Toast container -->
  <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

  <script>
    /*****************************************
     * Inventory.html
     * - localStorage.inventoryData (auto-save)
     * - default products: shirts, cap, umbrella, perfume
     * - category auto-fill + editable category (datalist)
     * - auto total calc (price √ó qty) but editable
     * - toasts (top-right) with Undo for Edit/Delete
     * - low-stock highlight when quantity < LOW_STOCK_THRESHOLD
     *****************************************/

    // Config
    const PRODUCT_PRICES = { shirts: 200, cap: 100, umbrella: 200, perfume: 500 };
    const PRODUCT_CATEGORY_MAP = {
      shirts: 'clothing',
      cap: 'accessories',
      umbrella: 'outdoor',
      perfume: 'fragrance'
    };
    const LOW_STOCK_THRESHOLD = 20;

    // DOM refs
    const openAddBtn = document.getElementById('openAddBtn');
    const productModal = document.getElementById('productModal');
    const productForm = document.getElementById('productForm');
    const modalTitle = document.getElementById('modalTitle');
    const saveProductBtn = document.getElementById('saveProductBtn');
    const cancelModalBtn = document.getElementById('cancelModalBtn');

    const prodName = document.getElementById('prodName');
    const prodCategory = document.getElementById('prodCategory');
    const prodQty = document.getElementById('prodQty');
    const prodTotal = document.getElementById('prodTotal');

    const inventoryTable = document.getElementById('inventoryTable');
    const emptyHint = document.getElementById('emptyHint');

    const searchInput = document.getElementById('searchInput');
    const categoryFilter = document.getElementById('categoryFilter');

    const deleteModal = document.getElementById('deleteModal');
    const deleteMessage = document.getElementById('deleteMessage');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');

    const toastContainer = document.getElementById('toastContainer');

    // Undo state
    let lastDeleted = null; // { item, timeoutId }
    let lastEdited = null;  // { oldItem, timeoutId }

    // Editing state
    let editingId = null;
    let deleteTargetId = null;

    // localStorage helpers
    function getInventoryData() {
      try {
        const raw = localStorage.getItem('inventoryData');
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch (e) {
        console.warn('Failed to parse inventoryData', e);
        return [];
      }
    }
    function setInventoryData(arr) {
      localStorage.setItem('inventoryData', JSON.stringify(arr));
      // notify other tabs/pages
      window.dispatchEvent(new Event('storage'));
    }

    // Modal helpers
    function openModal(modal) {
      modal.classList.remove('hidden');
      modal.style.display = 'flex';
      document.body.classList.add('modal-open');
    }
    function closeModal(modal) {
      modal.classList.add('hidden');
      modal.style.display = '';
      document.body.classList.remove('modal-open');
    }

    function resetForm() {
      productForm.reset();
      editingId = null;
      saveProductBtn.textContent = 'Add';
      modalTitle.textContent = 'Add Product';
    }

    // Auto-fill category & total when product selected
    prodName.addEventListener('change', () => {
      const key = prodName.value;
      if (PRODUCT_CATEGORY_MAP[key]) prodCategory.value = PRODUCT_CATEGORY_MAP[key];
      // compute total if qty present
      const qty = Math.max(0, Number(prodQty.value || 0));
      if (key && qty >= 0) {
        prodTotal.value = (PRODUCT_PRICES[key] || 0) * qty;
      }
    });

    // When qty changes, update total (if product chosen)
    prodQty.addEventListener('input', () => {
      const key = prodName.value;
      const qty = Math.max(0, Number(prodQty.value || 0));
      if (key) {
        prodTotal.value = (PRODUCT_PRICES[key] || 0) * qty;
      }
    });

    // Render inventory rows
    function renderInventoryRows() {
      // clear existing generated rows
      inventoryTable.querySelectorAll('.inventory-row').forEach(n => n.remove());
      const data = getInventoryData().slice().sort((a,b) => Number(b.id) - Number(a.id)); // newest first

      if (!data || data.length === 0) {
        if (emptyHint) emptyHint.style.display = '';
      } else {
        if (emptyHint) emptyHint.style.display = 'none';
        data.forEach(item => {
          const row = createRowElement(item);
          inventoryTable.appendChild(row);
        });
      }
      applyFilters();
    }

    function createRowElement(item) {
      const row = document.createElement('div');
      row.className = 'flex items-center px-6 py-4 inventory-row';
      row.dataset.id = item.id;
      row.dataset.category = (item.category || '').toLowerCase();

      // low-stock highlight
      const lowClass = Number(item.quantity) < LOW_STOCK_THRESHOLD ? 'low-stock' : '';

      row.innerHTML = `
        <div class="w-1/4 ${lowClass}">${escapeHtml(item.product)}</div>
        <div class="w-1/5 ${lowClass} text-sm">${escapeHtml(capitalize(item.category || ''))}</div>
        <div class="w-1/5 ${lowClass} text-sm">${Number(item.quantity)}</div>
        <div class="w-1/5 ${lowClass} text-sm">‚Ç±${Number(item.total).toFixed(2)}</div>
        <div class="w-1/6 text-right">
          <button class="editBtn inline-flex items-center px-3 py-1.5 border border-gray-300 rounded-md text-sm mr-2 hover:bg-gray-50">Edit</button>
          <button class="deleteBtn inline-flex items-center px-3 py-1.5 border border-red-300 rounded-md text-sm text-red-600 hover:bg-red-50">Delete</button>
        </div>
      `;

      // apply low-stock background to entire row if needed
      if (Number(item.quantity) < LOW_STOCK_THRESHOLD) {
        row.classList.add('low-stock');
      }

      const editBtn = row.querySelector('.editBtn');
      const deleteBtn = row.querySelector('.deleteBtn');

      editBtn.addEventListener('click', () => {
        editingId = row.dataset.id;
        const data = getInventoryData();
        const it = data.find(d => String(d.id) === String(editingId));
        if (!it) return alert('Item not found.');
        // prefill
        prodName.value = it.product;
        prodCategory.value = it.category || '';
        prodQty.value = it.quantity;
        prodTotal.value = Number(it.total).toFixed(2);
        saveProductBtn.textContent = 'Save';
        modalTitle.textContent = 'Edit Product';
        openModal(productModal);
      });

      deleteBtn.addEventListener('click', () => {
        deleteTargetId = row.dataset.id;
        const name = row.children[0].textContent.trim();
        deleteMessage.textContent = `Are you sure you want to delete "${name}"? This action cannot be undone.`;
        openModal(deleteModal);
      });

      return row;
    }

    // Add / Save handler
    productForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const product = (prodName.value || '').toString().trim();
      const category = (prodCategory.value || '').toString().trim().toLowerCase();
      const quantity = Number(prodQty.value || 0);
      const total = Number(prodTotal.value || 0);

      if (!product || !category) {
        alert('Please provide product and category.');
        return;
      }

      const all = getInventoryData();
      if (editingId) {
        // update existing item + store old copy for undo
        const idx = all.findIndex(i => String(i.id) === String(editingId));
        if (idx === -1) { alert('Item not found.'); closeModal(productModal); resetForm(); return; }
        const oldCopy = { ...all[idx] };

        all[idx] = {
          ...all[idx],
          product,
          category,
          quantity,
          total
        };
        setInventoryData(all);
        closeModal(productModal);
        resetForm();
        renderInventoryRows();

        // toast with undo for edit
        if (lastEdited && lastEdited.timeoutId) { clearTimeout(lastEdited.timeoutId); lastEdited = null; }
        lastEdited = { oldItem: oldCopy, timeoutId: setTimeout(() => { lastEdited = null; }, 3000) };
        showToast('Edit', `‚úèÔ∏è "${product}" updated.`, 'blue', true);
      } else {
        // new item
        const newItem = {
          id: Date.now().toString(),
          product,
          category,
          quantity,
          total
        };
        all.push(newItem);
        setInventoryData(all);
        closeModal(productModal);
        resetForm();
        // append new row at top (we re-render to ensure sort)
        renderInventoryRows();
        showToast('Add', `‚úÖ "${product}" added.`, 'green', false);
      }
    });

    // Confirm delete
    confirmDeleteBtn.addEventListener('click', () => {
      if (!deleteTargetId) { closeModal(deleteModal); return; }
      let all = getInventoryData();
      const idx = all.findIndex(i => String(i.id) === String(deleteTargetId));
      if (idx === -1) { closeModal(deleteModal); deleteTargetId = null; return; }
      const removed = all.splice(idx,1)[0];
      setInventoryData(all);
      closeModal(deleteModal);
      deleteTargetId = null;
      renderInventoryRows();

      // save lastDeleted for undo
      if (lastDeleted && lastDeleted.timeoutId) { clearTimeout(lastDeleted.timeoutId); lastDeleted = null; }
      lastDeleted = { item: removed, timeoutId: setTimeout(() => { lastDeleted = null; }, 3000) };
      showToast('Delete', `üóëÔ∏è "${removed.product}" deleted.`, 'red', true);
    });

    cancelDeleteBtn.addEventListener('click', () => {
      deleteTargetId = null;
      closeModal(deleteModal);
    });

    // Open Add modal
    openAddBtn.addEventListener('click', () => {
      resetForm();
      openModal(productModal);
    });
    cancelModalBtn.addEventListener('click', () => {
      closeModal(productModal);
      resetForm();
    });

    // Search + filter
    function applyFilters() {
      const searchText = (searchInput.value || '').toLowerCase().trim();
      const selectedCategory = (categoryFilter.value || 'all').toLowerCase();

      const rows = Array.from(inventoryTable.querySelectorAll('.inventory-row'));

      if (rows.length === 0) {
        if (emptyHint) emptyHint.style.display = '';
      } else {
        if (emptyHint) emptyHint.style.display = 'none';
      }

      rows.forEach(row => {
        const productText = row.children[0].textContent.toLowerCase();
        const categoryText = row.dataset.category ? row.dataset.category.toLowerCase() : row.children[1].textContent.toLowerCase();
        const textMatch = productText.includes(searchText) || categoryText.includes(searchText);
        const categoryMatch = selectedCategory === 'all' || categoryText === selectedCategory;
        row.style.display = (textMatch && categoryMatch) ? '' : 'none';
      });
    }

    searchInput.addEventListener('input', applyFilters);
    categoryFilter.addEventListener('change', applyFilters);

    // Toast system (same style as Sales)
    // color: 'green'|'blue'|'red' ; withUndo: boolean
    function showToast(typeName, message, color, withUndo=false) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      const colorMap = { green: '#10b981', blue: '#2563eb', red: '#ef4444' };
      const leftColor = colorMap[color] || '#10b981';
      toast.innerHTML = `
        <div class="left-border" style="background:${leftColor}"></div>
        <div class="content">
          <div class="text-sm">${escapeHtml(message)}</div>
        </div>
        <div class="actions">
          ${withUndo ? '<div class="undo">Undo</div>' : ''}
        </div>
      `;
      toastContainer.appendChild(toast);

      if (toastContainer.children.length > 5) toastContainer.removeChild(toastContainer.firstChild);

      if (withUndo) {
        const undoEl = toast.querySelector('.undo');
        undoEl.addEventListener('click', () => {
          // Undo delete first
          if (lastDeleted && lastDeleted.item) {
            const all = getInventoryData();
            // restore using original id (preserve)
            all.push(lastDeleted.item);
            setInventoryData(all);
            renderInventoryRows();
            clearTimeout(lastDeleted.timeoutId);
            lastDeleted = null;
            toast.querySelector('.content').innerHTML = '<div class="text-sm">üîÅ Restored</div>';
            setTimeout(() => dismissToast(toast), 900);
            return;
          }
          // Undo edit
          if (lastEdited && lastEdited.oldItem) {
            const all = getInventoryData();
            const idx = all.findIndex(i => String(i.id) === String(lastEdited.oldItem.id));
            if (idx !== -1) {
              all[idx] = lastEdited.oldItem;
            } else {
              all.push(lastEdited.oldItem);
            }
            setInventoryData(all);
            renderInventoryRows();
            clearTimeout(lastEdited.timeoutId);
            lastEdited = null;
            toast.querySelector('.content').innerHTML = '<div class="text-sm">üîÅ Reverted changes</div>';
            setTimeout(() => dismissToast(toast), 900);
            return;
          }
          toast.querySelector('.content').innerHTML = '<div class="text-sm">Nothing to undo</div>';
          setTimeout(() => dismissToast(toast), 900);
        });
      }

      const outTimer = setTimeout(() => {
        dismissToast(toast);
        if (withUndo) {
          if (lastDeleted && lastDeleted.timeoutId) { clearTimeout(lastDeleted.timeoutId); lastDeleted = null; }
          if (lastEdited && lastEdited.timeoutId) { clearTimeout(lastEdited.timeoutId); lastEdited = null; }
        }
      }, 3000);

      toast.addEventListener('click', (e) => {
        if (!e.target.classList.contains('undo')) {
          clearTimeout(outTimer);
          dismissToast(toast);
        }
      });

      return toast;
    }

    function dismissToast(toast) {
      if (!toast) return;
      toast.style.animation = 'toast-out .12s ease forwards';
      setTimeout(() => { if (toast.parentElement) toast.parentElement.removeChild(toast); }, 120);
    }

    // Utilities
    function capitalize(s) { if (!s) return ''; return s.charAt(0).toUpperCase() + s.slice(1); }
    function escapeHtml(unsafe) { return String(unsafe || '').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#039;'); }

    // Listen to storage events (sync with Sales.html / Dashboard)
    window.addEventListener('storage', (e) => {
      if (e.key === 'inventoryData' || e.key === 'salesData' || e.key === null) {
        // if salesData changed, we don't auto-deduct here - Sales page is responsible for deduction.
        // but we still re-render to reflect latest inventoryData
        renderInventoryRows();
      }
    });

    // Close modals with Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (!productModal.classList.contains('hidden')) closeModal(productModal);
        if (!deleteModal.classList.contains('hidden')) closeModal(deleteModal);
      }
    });

    // Init
    (function init() {
      renderInventoryRows();
    })();
  </script>
</body>
</html>
