<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AUG DEPT.</title>
  <link rel="icon" type="image/x-icon" href="https://placehold.co/32x32/FFFFFF/000000?text=AD">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Alfa+Slab+One&display=swap" rel="stylesheet">
    <style>
    body { font-family: 'Inter', sans-serif; }
    .font-alfa { font-family: 'Alfa Slab One', cursive; }
    .card-number { font-size: 1.5rem; font-weight: 700; }
    canvas { width: 100% !important; height: 320px !important; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="flex h-full min-h-screen">
    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 text-white flex flex-col border-r border-gray-700 flex-shrink-0">
  <div class="h-20 flex items-center justify-center border-b border-gray-700">
    <h1 class="font-alfa text-4xl tracking-wider text-white">AUG DEPT.</h1>
  </div>

  <nav class="flex-1 px-4 py-6 space-y-2">
    <a href="Dashboard.html" class="sidebar-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700 transition-all duration-300 ease-in-out hover:scale-105">
      Dashboard 
    </a>
    <a href="Sales.html" class="sidebar-link flex items-center py-2.5 px-4 rounded-lg bg-gray-900 text-white transition-all duration-300 ease-in-out hover:bg-gray-700 hover:scale-105">
      Sales
    </a>
    <a href="Inventory.html" class="sidebar-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700 transition-all duration-300 ease-in-out hover:scale-105">
      Inventory
    </a>
  </nav>

  <div class="px-4 py-6 border-t border-gray-700">
    <a href="index.html" class="sidebar-link flex items-center py-2.5 px-4 rounded-lg hover:bg-gray-700 transition-all duration-300 ease-in-out hover:scale-105">
      Logout
    </a>
  </div>
</aside>

<script>
  // Add fade-out transition when clicking a sidebar link
  const links = document.querySelectorAll('.sidebar-link');

  links.forEach(link => {
    link.addEventListener('click', function (e) {
      e.preventDefault(); // stop instant navigation
      document.body.classList.add('opacity-0', 'transition-opacity', 'duration-100');
      setTimeout(() => {
        window.location = this.href; // navigate after fade-out
      }, 400); // wait for animation to finish
    });
  });

  // Fade-in effect when the page loads
  window.addEventListener('load', () => {
    document.body.classList.remove('opacity-0');
    document.body.classList.add('opacity-100', 'transition-opacity', 'duration-100');
  });
</script>


    <!-- Main content -->
    <main class="flex-1 p-8 overflow-y-auto bg-gray-50">
      <h2 class="text-3xl font-bold mb-8">Sales</h2>

      <!-- Search -->
        <class id="searchSales">

      <!-- Product List -->
      <div class="border border-black rounded-lg overflow-hidden mb-10 flex-1 overflow-y-auto bg-white">
        <div class="flex text-sm font-semibold text-gray-600 bg-gray-50 px-6 py-3 border-b border-black bg-white">
          <div class="w-1/4">Product</div>
          <div class="w-1/6">Category</div>
          <div class="w-1/6">Size</div>
          <div class="w-1/6">Quantity</div>
          <div class="w-1/6">Price (₱)</div>
          <div class="w-1/6 text-right">Action</div>
        </div>
        <div id="salesTable" class="divide-y divide-gray-200 min-h-[120px] border-black">
          <div id="noSales" class="px-6 py-8 text-center text-gray-500">
            No products available. Add some in Inventory.
          </div>
        </div>
      </div>

      <!-- Sales Record Section -->
      <h3 class="text-2xl font-bold mb-4">Sales History</h3>
      <div class="border border-black rounded-lg overflow-hidden mb-6 flex-1 overflow-y-auto bg-white">
        <div class="flex text-sm font-semibold text-gray-600 bg-gray-50 px-6 py-3 border-b border-black bg-white">
          <div class="w-1/4">Product</div>
          <div class="w-1/6">Category</div>
          <div class="w-1/6">Size</div>
          <div class="w-1/6">Quantity Sold</div>
          <div class="w-1/6">Date</div>
          <div class="w-1/6">Subtotal (₱)</div>
        </div>
        <div id="salesRecordsTable" class="divide-y divide-gray-200 min-h-[100px] border-black">
          <div id="noRecords" class="px-6 py-8 text-center text-gray-500">
            No sales recorded yet.
          </div>
        </div>
      </div>

      <!-- ✅ Clear Data Button -->
      <div class="mt-10 text-center">
        <button id="clearData" class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">
          Clear All Data
        </button>
      </div>
    </main>
  </div>

  <script>
    const salesTable = document.getElementById('salesTable');
    const noSales = document.getElementById('noSales');
    const searchSales = document.getElementById('searchSales');
    const recordsTable = document.getElementById('salesRecordsTable');
    const noRecords = document.getElementById('noRecords');

    function getInventoryData() {
      try { return JSON.parse(localStorage.getItem('inventoryData')) || []; }
      catch { return []; }
    }
    function setInventoryData(arr) {
      localStorage.setItem('inventoryData', JSON.stringify(arr));
    }

    function getSalesRecords() {
      try { return JSON.parse(localStorage.getItem('salesRecords')) || []; }
      catch { return []; }
    }
    function setSalesRecords(arr) {
      localStorage.setItem('salesRecords', JSON.stringify(arr));
    }

    function renderSales() {
      const data = getInventoryData();
      salesTable.querySelectorAll('.sales-row').forEach(e => e.remove());
      if (!data.length) { noSales.style.display = ''; return; }
      noSales.style.display = 'none';

      data.forEach(item => {
        const row = document.createElement('div');
        row.className = 'flex items-center px-6 py-4 sales-row';
        row.dataset.category = item.category.toLowerCase();

        const unitPrice = item.quantity > 0 ? (item.total / item.quantity) : 0;

        row.innerHTML = `
          <div class="w-1/4 text-sm">${item.product}</div>
          <div class="w-1/6 text-sm">${capitalize(item.category)}</div>
          <div class="w-1/6 text-sm">${item.size || '-'}</div>
          <div class="w-1/6 text-sm">${item.quantity}</div>
          <div class="w-1/6 text-sm">₱${unitPrice.toFixed(2)}</div>
          <div class="w-1/6 text-right">
            <button class="sellBtn px-3 py-1.5 border rounded-md text-sm bg-blue-600 text-white hover:bg-blue-700">Sell</button>
          </div>
        `;
        salesTable.appendChild(row);
      });
    }

    function renderSalesRecords() {
      const records = getSalesRecords();
      recordsTable.querySelectorAll('.record-row').forEach(e => e.remove());
      if (!records.length) { noRecords.style.display = ''; return; }
      noRecords.style.display = 'none';

      records.forEach(r => {
        const row = document.createElement('div');
        row.className = 'flex items-center px-6 py-4 record-row text-sm';
        row.dataset.category = r.category ? r.category.toLowerCase() : '';

        row.innerHTML = `
          <div class="w-1/4">${r.product}</div>
          <div class="w-1/6">${capitalize(r.category)}</div>
          <div class="w-1/6">${r.size || '-'}</div>
          <div class="w-1/6">${r.quantity}</div>
          <div class="w-1/6">${r.date}</div>
          <div class="w-1/6">₱${r.subtotal.toFixed(2)}</div>
        `;
        recordsTable.appendChild(row);
      });
    }

    function capitalize(s){return s ? s[0].toUpperCase()+s.slice(1) : ''; }

    // Sell button action
    salesTable.addEventListener('click', (e) => {
      if (!e.target.classList.contains('sellBtn')) return;
      const row = e.target.closest('.sales-row');
      const categoryName = row.dataset.category;
      const productName = row.children[0].innerText;
      const size = row.children[2].innerText === '-' ? '' : row.children[2].innerText;
      const inventory = getInventoryData();

      const item = inventory.find(i => 
        i.product.toLowerCase() === productName.toLowerCase() &&
        i.category.toLowerCase() === categoryName &&
        (i.size || '') === size
      );

      if (!item) return alert('Item not found!');
      if (item.quantity <= 0) return alert('Out of stock!');

      const sellQty = parseInt(prompt(`How many ${item.product}${size ? ' (' + size + ')' : ''} do you want to sell?`, 1));
      if (isNaN(sellQty) || sellQty <= 0) return;
      if (sellQty > item.quantity) return alert('Not enough stock!');

      const unitPrice = item.total / item.quantity;
      const subtotal = unitPrice * sellQty;
      item.quantity -= sellQty;
      item.total -= subtotal;

      const now = new Date();
      const date = `${now.toLocaleDateString()} ${now.toLocaleTimeString()}`;
      const category = item.category;
      const salesRecords = getSalesRecords();
      salesRecords.push({
        product: item.product,
        category,
        size,
        quantity: sellQty,
        date,
        subtotal
      });

      setInventoryData(inventory);
      setSalesRecords(salesRecords);
      renderSales();
      renderSalesRecords();
      alert(`Sold ${sellQty} ${item.product}${size ? ' (' + size + ')' : ''} successfully!`);
    });

    // ✅ Search category filter (for both tables)
    searchSales.addEventListener('input', () => {
      const search = searchSales.value.toLowerCase();
      document.querySelectorAll('.sales-row').forEach(row => {
        const category = row.dataset.category;
        row.style.display = category.includes(search) ? '' : 'none';
      });
      document.querySelectorAll('.record-row').forEach(row => {
        const category = row.dataset.category;
        row.style.display = category.includes(search) ? '' : 'none';
      });
    });

    // ✅ Clear Data Button Function
    document.getElementById('clearData').addEventListener('click', () => {
      if (confirm("Are you sure you want to clear all saved data?")) {
        localStorage.clear();
        alert("All data has been cleared!");
        location.reload();
      }
    });

    renderSales();
    renderSalesRecords();
  </script>
</body>
</html>